# Trivy Configuration for os-builder repository
# Centralized configuration to ensure consistency across all workflows
# Fixed to handle AWS policy parsing errors and remove invalid config options

# General settings
format: table
exit-code: 1
quiet: false

# Scanner configuration - Only essential scanners (NO cloud policy scanning)
scanners:
  - vuln      # Vulnerability scanning
  - secret    # Secret detection
  # misconfig scanner disabled - causes cloud policy issues

# Misconfiguration scanning disabled to prevent cloud policy issues

# Severity levels to scan for (can be overridden by workflow inputs)
severity:
  - CRITICAL
  - HIGH
  - MEDIUM

# Standardized skip directories for all scan types
# These directories are commonly excluded across all workflows
skip-dirs:
  - .git/
  - .github/
  - node_modules/
  - .vscode/
  - .idea/
  - dist/
  - build/
  - target/
  - vendor/
  - /var/cache
  - /var/log/dnf*
  - /var/lib/dnf
  - /tmp
  # Skip Trivy's own cache directory to prevent scanning policy examples
  - .cache/trivy/
  - /root/.cache/trivy/

# Skip files that don't need scanning
skip-files:
  - "*.md"
  - "*.txt"
  - "*.log"
  - "*.tar.gz"
  - "*.tar.xz"
  - "*.tar.zst"
  - "*.zip"
  - "*.rpm"
  - "*.deb"
  - "LICENSE*"
  - "NOTICE*"
  - "CHANGELOG*"
  - "*.cache"

# Vulnerability scanning settings
vuln:
  type:
    - os
    - library

# Secret scanning settings
secret:
  skip-dirs:
    - .git/
    - .github/actions/
    # Skip Trivy cache to prevent false positives from policy examples
    - .cache/trivy/
    - /root/.cache/trivy/
  skip-files:
    - "*.md"
    - "*.example"
    - "*.template"

# Output configuration
output:
  clean: true
  
# Ignore unfixed vulnerabilities for better signal-to-noise ratio
ignore-unfixed: true

# Performance settings
timeout: 10m

# Cache settings
cache:
  cache-dir: ~/.cache/trivy 